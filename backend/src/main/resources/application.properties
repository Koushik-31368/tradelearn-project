# ===================================================================
# TradeLearn Backend — Core Configuration
# ===================================================================
# Profile-specific overrides: application-{profile}.properties
# Active profile set by SPRING_PROFILES_ACTIVE env var (default: local)
# ===================================================================

spring.profiles.active=${SPRING_PROFILES_ACTIVE:local}

# ===== APPLICATION =====
spring.application.name=tradelearn-backend
server.port=${PORT:8080}

# ===== THREAD POOL SIZING (10K concurrent games) =====
server.tomcat.threads.max=${TOMCAT_MAX_THREADS:200}
server.tomcat.threads.min-spare=${TOMCAT_MIN_THREADS:20}
server.tomcat.max-connections=${TOMCAT_MAX_CONNECTIONS:10000}
server.tomcat.accept-count=${TOMCAT_ACCEPT_COUNT:200}

# ===== GAME SCHEDULER =====
tradelearn.scheduler.pool-size=${SCHEDULER_POOL_SIZE:64}
tradelearn.scheduler.await-termination-seconds=10

# ===== RATE LIMITING =====
tradelearn.ratelimit.enabled=${RATE_LIMIT_ENABLED:true}
tradelearn.ratelimit.general.rpm=${RATE_LIMIT_GENERAL:100}
tradelearn.ratelimit.trades.rpm=${RATE_LIMIT_TRADES:60}
tradelearn.ratelimit.create.rpm=${RATE_LIMIT_CREATE:10}

# ===== DISASTER RECOVERY =====
# Database probe interval (ms) for health monitoring
tradelearn.db.probe-interval-ms=${DB_PROBE_INTERVAL:5000}
# Redis circuit breaker — consecutive failures before tripping
tradelearn.redis.cb.failure-threshold=${REDIS_CB_THRESHOLD:5}
# Redis circuit breaker — cooldown before probe attempt (ms)
tradelearn.redis.cb.cooldown-ms=${REDIS_CB_COOLDOWN:30000}
# Database circuit breaker — consecutive failures before tripping
tradelearn.db.cb.failure-threshold=${DB_CB_THRESHOLD:3}
# Database circuit breaker — cooldown before probe attempt (ms)
tradelearn.db.cb.cooldown-ms=${DB_CB_COOLDOWN:20000}

# ===== SECURITY HEADERS =====
tradelearn.security.hsts.enabled=${HSTS_ENABLED:true}
tradelearn.security.hsts.max-age=31536000

# ===== JWT =====
tradelearn.jwt.secret=${JWT_SECRET:ChangeThisToAVeryLongSecretKeyForProductionAtLeast64BytesLong2024TradeLearn}
tradelearn.jwt.previous-secret=${JWT_PREVIOUS_SECRET:}
tradelearn.jwt.expiration-ms=${JWT_EXPIRATION_MS:86400000}

# ===== WEBSOCKET CONNECT RATE LIMITING =====
tradelearn.ws.connect-rate-limit=${WS_CONNECT_RATE_LIMIT:10}

# ===== POSITION SNAPSHOT STORE =====
tradelearn.snapshot.max-entries=${SNAPSHOT_MAX_ENTRIES:20000}

# ===== ACTUATOR / MONITORING =====
management.endpoints.web.exposure.include=health,info,metrics,prometheus
management.endpoint.health.show-details=when-authorized
management.metrics.tags.application=tradelearn

# ===== JACKSON =====
spring.jackson.serialization.write-dates-as-timestamps=false
spring.jackson.default-property-inclusion=non_null
